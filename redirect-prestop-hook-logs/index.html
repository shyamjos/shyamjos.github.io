<!doctype html><html lang=en><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.75.1"><title>How to redirect PreStop hook output to pod logs</title><meta name=description content="Hey I am Shyam Jos. Welcome to my personal blog, where I write about Linux, DevOps, Cloud and Automation."><meta name=keywords content="DevOps,linux,cloud,automation,sysadmin,blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shyamjos.com/assets/img/featured.jpg"><meta name=twitter:title content="How to redirect PreStop hook output to pod logs"><meta name=twitter:description content="So how can we see the PreStop hook command output in pod logs? By default container engine only redirects the stdout/err of the main process"><meta property="og:title" content="How to redirect PreStop hook output to pod logs"><meta property="og:description" content="So how can we see the PreStop hook command output in pod logs? By default container engine only redirects the stdout/err of the main process"><meta property="og:type" content="article"><meta property="og:url" content="https://shyamjos.com/redirect-prestop-hook-logs/"><meta property="og:image" content="https://shyamjos.com/assets/img/featured.jpg"><meta property="article:published_time" content="2021-09-25T00:00:00+00:00"><meta property="article:modified_time" content="2021-09-25T00:00:00+00:00"><meta property="og:site_name" content="Shyam Jos"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css><link rel=stylesheet href=/scss/hyde-hyde.03f492b0ad6edf623c0fbf2ef81ee986bf550b804a24aba3f4c184f69527c3ec.css integrity="sha256-A/SSsK1u32I8D78u+B7phr9VC4BKJKuj9MGE9pUnw+w="><link rel=stylesheet href=/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58+TzH3icCkSHGoJ+ed7w=" media=print><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=apple-touch-icon-precomposed sizes=144x144 href=/assets/img/apple-touch-icon.png><link rel="shortcut icon" href=/assets/img/favicon.ico><script>if(!sessionStorage.getItem("_swa")&&document.referrer.indexOf(location.protocol+"//"+location.host)!==0){fetch("https://counter.dev/track?"+new URLSearchParams({referrer:document.referrer,screen:screen.width+"x"+screen.height,user:"shyamjosepp@gmail.com",utcoffset:"6"}))};sessionStorage.setItem("_swa","1");</script></head><body><div class=sidebar><div class=container><div class=sidebar-about><span class=site__title><a href=https://shyamjos.com/>Shyam Jos</a></span><div class=author-image><img src=https://shyamjos.com/assets/img/shyam_jos_photo.jpeg alt="Author Image" class="img--circle img--headshot element--center"></div><p class=site__description>Random Bits From A SRE/DevOps Engineer</p></div><div class=collapsible-menu><input type=checkbox id=menuToggle>
<label for=menuToggle>Shyam Jos</label><div class=menu-content><div><ul class=sidebar-nav><li><a href=/><span>Blog</span></a></li><li><a href=/about/><span>About</span></a></li></ul></div><section class=social><a href=https://twitter.com/shyamjose rel=me><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a><a href=https://github.com/shyamjos rel=me><i class="fab fa-github fa-lg" aria-hidden=true></i></a><a href=https://linkedin.com/in/shyamjos rel=me><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a><a href=https://stackoverflow.com/users/2460764 rel=me><i class="fab fa-stack-overflow fa-lg" aria-hidden=true></i></a><a href=mailto:shyamjosepp+website@gmail.com rel=me><i class="fas fa-at fa-lg" aria-hidden=true></i></a></section></div></div><div class=copyright>&copy; 2022 Shyam Jos</div></div></div><div class="content container"><article><header><h1>How to redirect PreStop hook output to pod logs</h1><div class=post__meta><i class="fas fa-calendar-alt" style=padding-right:1px></i>25 Sep 2021<br><i class="fas fa-tags"></i><a class="badge badge-tag" style=padding-right:1px href=/tags/logging>logging</a>
<a class="badge badge-tag" style=padding-right:1px href=/tags/kubernetes>kubernetes</a>
<a class="badge badge-tag" style=padding-right:1px href=/tags/container>container</a><br><i class="fas fa-clock" style=padding-right:1px></i>1 min read</div></header><div class=post><p>You might have noticed that command output of PreStop hook wont appear in pod logs and only thing you can see is whether the PreStop hook command failed or not is by checking kubernetes events log.</p><p>So how can we see the PreStop hook command output in pod logs?</p><p>By default container engine only redirects the stdout/err of the main process (running with <code>PID 1</code>) to the logging driver. Since the PreStop hook runs as a separate process the output from this command wont appear in container logs.</p><h2 id=how-to-redirect-prestop-hook-command-output-to-container-logs->How to redirect PreStop hook command output to container logs ?</h2><p>In Linux you can easily redirect stdout/err of one process to another by writing to the other process&rsquo;s stdout/err file descriptor (/proc/PID/fd/1 or /proc/PID/fd/2). In our case we can redirect the stdout of PreStop hook command to our main process&rsquo;s stdout using the command <code>echo "Hello from the other side" > /proc/1/fd/1</code> and this message will be appear in the container logs.</p><h2 id=example-prestop-hook-command-with-output-redirection>Example PreStop hook command with output redirection</h2><pre><code> lifecycle:
          preStop :
             exec:
               command: [&quot;bash&quot;, &quot;uptime &gt; /proc/1/fd/1&quot;]           
</code></pre></div><link href=//cdn-images.mailchimp.com/embedcode/classic-10_7_dtp.css rel=stylesheet type=text/css><style type=text/css>#mc_embed_signup{background:#f8f8f8;clear:left;font:14px Helvetica,Arial,sans-serif;width:663px}</style><div id=mc_embed_signup><form action="https://shyamjos.us11.list-manage.com/subscribe/post?u=965be0bf90a8bd031bf02e3d2&id=2c71c7959b" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class=validate target=_blank novalidate><div id=mc_embed_signup_scroll><h2>Subscribe to my weekly Newsletter</h2><div class=indicates-required><span class=asterisk>*</span> indicates required</div><div class=mc-field-group><label for=mce-EMAIL>Email Address <span class=asterisk>*</span></label>
<input type=email name=EMAIL class="required email" id=mce-EMAIL></div><div id=mce-responses class="clear foot"><div class=response id=mce-error-response style=display:none></div><div class=response id=mce-success-response style=display:none></div></div><div style=position:absolute;left:-5000px aria-hidden=true><input type=text name=b_965be0bf90a8bd031bf02e3d2_2c71c7959b tabindex=-1></div><div class=optionalParent><div class="clear foot"><input type=submit value=Subscribe name=subscribe id=mc-embedded-subscribe class=button><p class=brandingLogo><a href=http://eepurl.com/h6Ijnb title="Mailchimp - email marketing made easy and fun"><img src=https://eep.io/mc-cdn-images/template_images/branding_logo_text_dark_dtp.svg></a></p></div></div></div></form></div><script type=text/javascript src=//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js></script><script type=text/javascript>(function($){window.fnames=new Array();window.ftypes=new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';}(jQuery));var $mcj=jQuery.noConflict(true);</script><p></p><script type=text/javascript src=https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js data-name=bmc-button data-slug=shyamjos data-color=#deddda data-emoji data-font=Bree data-text="Buy me a coffee" data-outline-color=#000000 data-font-color=#000000 data-coffee-color=#FFDD00></script><div class=post__related><h2>Related Articles</h2><ul class=related-posts><li><span class=list__title--small><a href=/redirecting-codeigniter-logs-to-container-stdout-stderr/>Redirect CodeIgniter logs to container's STDOUT/ERR</a>
<time class="pull-right hidden-tablet">20 Aug 2021</time></span></li></ul></div></article></div><script defer src=https://use.fontawesome.com/releases/v5.12.1/js/all.js integrity=sha384-ZbbbT1gw3joYkKRqh0kWyRp32UAvdqkpbLedQJSlnI8iLQcFVxaGyrOgOJiDQTTR crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js></script><script type=text/javascript>hljs.initHighlightingOnLoad();</script></body></html>